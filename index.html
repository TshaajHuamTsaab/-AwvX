<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>è±¡å¾å¿—ä¸‰æ®µå¿—</title>
<style>
body {
  margin: 0;
  font-family: "Microsoft YaHei", sans-serif;
  background: black;
  color: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  overflow: hidden;
}
h1 { margin-bottom: 20px; font-size: 2.5em; }
.line {
  margin: 15px 0;
  font-size: 2em;
  text-align: center;
}
.highlight {
  color: gold;
  font-weight: bold;
}
.controls {
  position: absolute;
  bottom: 20px;
}
button {
  margin: 10px;
  padding: 15px 30px;
  border: none;
  border-radius: 10px;
  font-size: 1.2em;
  cursor: pointer;
  font-weight: bold;
}
#playBtn { background: royalblue; color: white; }
#stopBtn { background: crimson; color: white; }
.navBtn { background: seagreen; color: white; }
button:hover { opacity: 0.8; }
#successBtn {
  display: none;
  position: absolute;
  top: 20px;
  font-size: 1.5em;
  background: gold;
  color: black;
  font-weight: bold;
  padding: 10px 20px;
  border-radius: 8px;
}
canvas {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: -1;
}
</style>
</head>
<body>
<canvas id="space"></canvas>
<h1 id="title">è¿‡å»</h1>
<div id="text"></div>

<div class="controls">
  <button class="navBtn" onclick="prevPage()">ä¸Šä¸€é¡µ</button>
  <button id="playBtn" onclick="playText()">æ’­æ”¾æœ—è¯»</button>
  <button id="stopBtn" onclick="stopText()">åœæ­¢æœ—è¯»</button>
  <button class="navBtn" onclick="nextPage()">ä¸‹ä¸€é¡µ</button>
</div>

<button id="successBtn">ç¥ä½ æˆåŠŸğŸ†</button>

<script>
let pages = [
  {
    title: "è¿‡å»",
    lines: [
      "åˆå¿ƒæ˜¯å¦çœŸè¯šï¼Œä¸ä¸ºè™šè£å·¦å³ã€‚",
      "å¿—è¡Œæ˜¯å¦ä¸€è‡´ï¼Œè¡ŒåŠ¨é…å¾—å¿—ã€‚",
      "å¾—å¤±èƒ½å¦æ€»ç»“ï¼Œé”™è¯¯åŒ–ä¸ºåŠ›ã€‚",
      "å¿—å‘æ˜¯å¦å…¼é¡¾ï¼Œä¸æŸä»–äººåˆ©ã€‚",
      "å¿—æ„¿æ˜¯å¦é€‚æ—¶ï¼Œç¯å¢ƒèƒ½ç›¸åˆã€‚"
    ]
  },
  {
    title: "ç°åœ¨",
    lines: [
      "æ˜ç¡®æ–¹å‘ä¸“æ³¨ï¼Œä¸éšæ½®æµæ‘‡æ‘†ã€‚",
      "ç«‹è¶³å½“ä¸‹è¡ŒåŠ¨ï¼Œä¸æ‹–å»¶ç©ºå¹»æƒ³ã€‚",
      "ä¿®å…»å“å¾·å¿ƒå¢ƒï¼Œå¿—ä¸ç¦»äºå¾·ã€‚",
      "å¹¿ç»“å–„ç¼˜åŠ©äººï¼Œè¡Œè·¯æœ‰äººæ‰¶ã€‚",
      "ä¸æƒ§å›°éš¾åšæŒï¼Œç§¯ç´¯ç»ˆæœ‰æˆã€‚"
    ]
  },
  {
    title: "æœªæ¥",
    lines: [
      "å¿—æ„¿é•¿è¿œè§„åˆ’ï¼Œä¸å›°äºä¸€æ—¶ã€‚",
      "ä¼ æ‰¿ç²¾ç¥ä»·å€¼ï¼Œä¸åªä¸ºå·±ã€‚",
      "ç§¯ç´¯æ™ºæ…§ç»éªŒï¼Œæƒ æ³½åä»£ã€‚",
      "å¿ƒæ€€å®½å¹¿èƒ¸è¥Ÿï¼Œå®¹çº³ä¸åŒã€‚",
      "ä¿æŒç»ˆèº«å­¦ä¹ ï¼Œä¸åœäºæˆã€‚"
    ]
  }
];

let currentPage = 0;
let container = document.getElementById("text");
let title = document.getElementById("title");
let timer, currentChar, currentLine, allLines;
let synth = window.speechSynthesis;
let utterance;
let reading = false;

function renderText() {
  container.innerHTML = "";
  title.textContent = pages[currentPage].title;
  pages[currentPage].lines.forEach(line => {
    let div = document.createElement("div");
    div.className = "line";
    for (let char of line) {
      let span = document.createElement("span");
      span.textContent = char;
      div.appendChild(span);
    }
    container.appendChild(div);
  });
}
renderText();

function nextPage() {
  if (currentPage < pages.length - 1) {
    currentPage++;
    renderText();
  }
}
function prevPage() {
  if (currentPage > 0) {
    currentPage--;
    renderText();
  }
}

function playText() {
  stopText();
  reading = true;
  currentChar = 0;
  currentLine = 0;
  allLines = container.querySelectorAll(".line");

  function speakNextLine() {
    if (!reading) return;
    if (currentLine >= allLines.length) {
      if (currentPage < pages.length - 1) {
        currentPage++;
        renderText();
        currentLine = 0;
        currentChar = 0;
        allLines = container.querySelectorAll(".line");
        speakNextLine();
      } else {
        document.getElementById("successBtn").style.display = "block";
      }
      return;
    }

    let lineText = allLines[currentLine].textContent;
    currentChar = 0;
    let spans = allLines[currentLine].querySelectorAll("span");

    utterance = new SpeechSynthesisUtterance(lineText);
    utterance.lang = "zh-CN";
    utterance.rate = 0.9;
    utterance.pitch = 1;

    // ä¼˜å…ˆé€‰æ‹©å¥³æ€§å£°éŸ³
    let voices = synth.getVoices();
    let female = voices.find(v => v.lang === "zh-CN" && /female|huihui|xiaoxiao/i.test(v.name));
    if (female) utterance.voice = female;

    utterance.onstart = () => {
      timer = setInterval(() => {
        if (currentChar < spans.length) {
          spans[currentChar].classList.add("highlight");
          currentChar++;
        }
      }, 300);
    };

    utterance.onend = () => {
      clearInterval(timer);
      currentLine++;
      speakNextLine();
    };

    synth.speak(utterance);
  }

  speakNextLine();
}

function stopText() {
  reading = false;
  clearInterval(timer);
  if (synth.speaking) synth.cancel();
  container.querySelectorAll("span").forEach(s => s.classList.remove("highlight"));
}

// ---------- èƒŒæ™¯å®‡å®™åŠ¨ç”» ----------
let canvas = document.getElementById("space");
let ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let stars = Array.from({length: 200}, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  r: Math.random() * 1.5,
  o: Math.random()
}));

let satellites = [];

function drawEarth() {
  let earthX = canvas.width * 0.8;
  let earthY = canvas.height * 0.8;
  let radius = 120;

  let gradient = ctx.createRadialGradient(earthX-30, earthY-30, 50, earthX, earthY, radius);
  gradient.addColorStop(0, "#1E90FF");
  gradient.addColorStop(1, "#001f3f");

  ctx.beginPath();
  ctx.arc(earthX, earthY, radius, 0, Math.PI*2);
  ctx.fillStyle = gradient;
  ctx.fill();
}

function drawStars() {
  stars.forEach(s => {
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
    ctx.fillStyle = `rgba(255,255,255,${Math.abs(Math.sin(Date.now()/1000+s.o))})`;
    ctx.fill();
  });
}

function drawSatellites() {
  satellites.forEach((sat, i) => {
    ctx.save();
    ctx.translate(sat.x, sat.y);
    ctx.rotate(sat.angle);
    ctx.fillStyle = "lightgray";
    ctx.fillRect(-10, -5, 20, 10);
    ctx.fillStyle = "silver";
    ctx.fillRect(-20, -2, 40, 4);
    ctx.restore();

    sat.x += sat.vx;
    sat.y += sat.vy;
    sat.life -= 1;
    if (sat.life <= 0) satellites.splice(i, 1);
  });
}

function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawStars();
  drawEarth();
  drawSatellites();
  if (Math.random() < 0.01) { // å¶å°”å‡ºç°å«æ˜Ÿ
    satellites.push({
      x: -50,
      y: 100 + Math.random()*canvas.height/2,
      vx: 3, vy: 0.5,
      angle: Math.random()*Math.PI,
      life: 150 // é£ä¸€åŠå°±æ¶ˆå¤±
    });
  }
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
